<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AK's Portfolio</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <!-- AOS library -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    
    <!-- Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>

    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

    <!-- AOS library -->
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./index.css">
</head>
<style>

    button:disabled{
        display: none;
    }

</style>
<body>
    <section class="portfolio-section pt-5 pb-5 w-100" id="manageDataSection">
        <div class="container">
            <div class="section-title">
                <h2 class="section-heading mt-5 d-flex">
                    <span class="custom-font-color"></span>Manage Projects Data.
                </h2>
                <p class="description1">Here, you can handle your project data by editing, deleting, or viewing it.</p>
            </div>
           
        
            <div class="d-flex justify-content-between">
                
                <input type="text" id="searchInput" class="form-control w-50 searchInputBox" placeholder="Search all projects by name" onkeyup="searchProjects()">
                <button onclick="addProject()" type="button" class="default-button" >
                    Add Project <i style="color:#ff4533" class="fa-solid fa-plus"></i>
                </button>

            </div>

            
    
            <div class="spinner" id="loading" style="display: none;"></div>
            <div class="no-projects-message" id="noProjectsMessage" style="display: none;">
                There are no projects at the moment.
            </div>
            <div class="row" id="projectsData"></div>
            
                <div class="d-flex justify-content-between align-items-center" id="paginationContainer" style="display: none !important">
                    <button onclick="changePage('prev')" id="prev-button" type="button" class="default-button" disabled>Prev</button> 
                    <p id="page-numbers"></p> 
                    <button onclick="changePage('next')" id="next-button" type="button" class="default-button">Next</button>
                </div>
            
        </div>
    </section>
  
  <!-- pop up Modal -->
  <div class="modal fade" id="popUpModal" tabindex="-1" role="dialog" aria-labelledby="popUpModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-body" style="text-align: center;padding-top: 5rem;padding-bottom: 5rem;">
        </div>
      </div>
    </div>
  </div>
    
    


    <!-- Modal -->
    <div class="modal fade" id="projectsModal"  role="dialog" aria-labelledby="projectsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="projectsModalLabel" style="color:#ff4533">Add Project Details</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span style="color: #ff4533" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="text-align: center;padding: 1rem;">
                    <div class="w-100">
                        <div class="box d-flex flex-column align-items-stretch" style="padding:1rem;">
                            <form id="projectsForm">
                                <div id="formLoader" class="form-spinner" style="display: none;left:40%"></div>
                                <span id="span"></span>

                                <div class="form-input-box">
                                    <!-- <label for="projectid">Project Id</label> -->
                                    <input class="mt-5" name="projectid" id="projectid"
                                        placeholder="projectid" hidden/>
                                </div>

                                <div class="form-input-box">
                                    <label for="projectname">Project Name</label>
                                    <input class="mt-5" type="text" name="projectname" id="projectname"
                                        placeholder="Enter your project name" required />
                                </div>

                                <div class="form-input-box">
                                    <label for="projecturl">Project URL</label>
                                    <input class="mt-5" type="text" name="projecturl" id="projecturl"
                                        placeholder="Enter your project URL" required />
                                </div>

                                <div class="form-input-box">
                                    <label for="logourl">Logo Image URL</label>
                                    <input class="mt-5" type="text" name="logourl" id="logourl"
                                        placeholder="Paste your logo URL" required />
                                </div>

                                <div class="form-input-box">
                                    <label for="projectimageurl">Project Image URL</label>
                                    <input class="mt-5" type="text" name="projectimageurl" id="projectimageurl"
                                        placeholder="Paste your project image URL" required />
                                </div>

                                <button class="form-input-box" type="submit" id="sub">Save <i
                                        class="fa-solid fa-paper-plane"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>

let currentPage = 1;
const itemsPerPage = 8;
let totalPages = 1;

const prevBtn = document.getElementById('prev-button');
const nextBtn = document.getElementById('next-button');
const pageNumbers = document.getElementById('page-numbers');
const apiEndpoint = 'https://668d0469099db4c579f16037.mockapi.io/api/data/projectData';
let allProjectsData = [];

document.addEventListener('DOMContentLoaded', () => {
    fetchProjects();
    document.getElementById('projectsForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const projectId = document.getElementById("projectid").value;
        const formData = getFormData();

        if (projectId) {
            updateProjectData(projectId, formData);
        } else {
            insertProjectData(formData);
        }
        $("#projectsModal").modal('hide');
    });
});

function searchProjects() {
    const query = document.getElementById("searchInput").value.toUpperCase();
    const filteredProjects = allProjectsData.filter(project => project.projectName.toUpperCase().includes(query));
    displayProjects(filteredProjects);
    document.getElementById('noProjectsMessage').innerHTML = "No projects found matching the search criteria."

}

async function fetchProjects() {
    const projectsData = document.getElementById('projectsData');
    const noProjectsMessage = document.getElementById('noProjectsMessage');
    showLoading();
    try {
        const response = await fetch(apiEndpoint);
        const projects = await response.json();
        allProjectsData = projects;
        totalPages = Math.ceil(allProjectsData.length / itemsPerPage);
        updatePagination();
        displayProjects(getCurrentPageProjects());
    } catch (error) {
        console.log(error);
    }
    hideLoading();
}

function getCurrentPageProjects() {
    const startIndex = (currentPage - 1) * itemsPerPage;
    console.log("startIndex: ", startIndex )
    const endIndex = startIndex + itemsPerPage;
    console.log("endIndex: ", endIndex )

    const currentPageProjects = allProjectsData.slice(startIndex, endIndex);
    return currentPageProjects;
}

function displayProjects(projects) {
    const projectsData = document.getElementById('projectsData');
    let htmlData = "";
    projectsData.innerHTML = "";
    if (projects.length === 0) {
        document.getElementById('noProjectsMessage').style.display = 'block';    
    
    } else {
        document.getElementById('noProjectsMessage').style.display = 'none';
        document.getElementById('paginationContainer').style.display = 'block';

        projects.forEach((project) => {
            htmlData += `
                <div class="col-12 col-md-6 col-lg-3" id="project-${project.id}">
                    <div class="project-section shadow p-3 mb-3">
                        <img src="${project.projectImg}" alt="${project.id}" class="project-image w-100" />
                        <h1 class="project-title">${project.projectName}</h1>
                        <div class="d-flex justify-content-between">
                            <a href="${project.projectUrl}" class="project-link" target="_blank">
                                View Project
                                <svg width="16px" height="16px" viewBox="0 0 16 16" class="bi bi-arrow-right-short" fill="#ff4533" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z" />
                                </svg>
                            </a>
                            <div class="edit-button" onclick="editRecord(${project.id})">
                                <a href="javascript:void(0)">
                                    <i class="fa fa-edit" style="color:greenyellow"></i>
                                </a>
                            </div>
                            <div class="delete-button" onclick="deleteRecord(${project.id})">
                                <a href="javascript:void(0)">
                                    <i class="fa fa-trash" style="color:#ff4533"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        projectsData.innerHTML = htmlData;
    }
}

function changePage(direction) {
    if (direction === 'prev' && currentPage > 1) {
        currentPage--;
    } else if (direction === 'next' && currentPage < totalPages) {
        currentPage++;
    }
    updatePagination();
    displayProjects(getCurrentPageProjects());
}

function updatePagination() {
    pageNumbers.innerHTML = `Page ${currentPage} of ${totalPages}`;
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
}

function addProject() {
    document.getElementById("projectsForm").reset();
    $("#projectsModal").modal('show');
}

async function insertProjectData(formData) {
    showFormLoader();
    try {
        const response = await fetch(apiEndpoint, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(formData)
        });

        if (!response.ok) throw new Error("Error in creating project");

        const result = await response.json();
        document.getElementById("projectsForm").reset();
        fetchProjects();
        displayResponse("Project created successfully!", "success");

    } catch (error) {
        console.error("Error:", error);
        displayResponse("Error creating project.", "error");
    } finally {
        hideFormLoader();
    }
}

function editRecord(id) {
    $("#projectsModal").modal('show');
    showFormLoader();
    fetch(`${apiEndpoint}/${id}`)
        .then(response => response.json())
        .then(project => {
            document.getElementById("projectid").value = project.id;
            document.getElementById("projectname").value = project.projectName;
            document.getElementById("projecturl").value = project.projectUrl;
            document.getElementById("logourl").value = project.logoPng;
            document.getElementById("projectimageurl").value = project.projectImg;
            document.getElementById("projectsModalLabel").innerText = "Edit Project Details";
            hideFormLoader();
        })
        .catch(error => console.error('Error fetching project data:', error));
}

async function updateProjectData(id, formData) {
    showFormLoader();
    try {
        const response = await fetch(`${apiEndpoint}/${id}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(formData)
        });
        if (!response.ok) throw new Error("Error in updating project");
        const result = await response.json();
        displayResponse("Project updated successfully!", "success");
        fetchProjects();
        document.getElementById("projectsForm").reset();

    } catch (error) {
        console.error("Error:", error);
        displayResponse("Error updating project.", "error");
    } finally {
        hideFormLoader();
    }
}

function deleteRecord(id) {
    if (confirm("Are you sure you want to delete this project?") == true) {
        fetch(`${apiEndpoint}/${id}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();

            })
            .then(() => {
                document.getElementById(`project-${id}`).remove();
                displayResponse("Project Successfully Deleted", "success");

                const remainingProjects = document.querySelectorAll('#projectsData .project-section');
                if (remainingProjects.length === 0) {
                    fetchProjects();
                }
            })
            .catch(error => console.error('Error deleting record:', error));
    }
}

function showFormLoader() {
    const loader = document.getElementById("formLoader");
    loader.style.display = "block";
    loader.classList.add('spinner');
}

function hideFormLoader() {
    const loader = document.getElementById("formLoader");
    loader.style.display = "none";
    loader.classList.remove('spinner');
}

function getFormData() {
    return {
        projectId: document.getElementById("projectid").value,
        projectName: document.getElementById("projectname").value,
        projectUrl: document.getElementById("projecturl").value,
        logoPng: document.getElementById("logourl").value,
        projectImg: document.getElementById("projectimageurl").value
    };
}

function showLoading() {
    document.getElementById("loading").style.display = "block";
}

function hideLoading() {
    document.getElementById("loading").style.display = "none";
}

function displayResponse(message, status) {
    const spanElement = document.getElementById("span");
    const modalBody = document.querySelector("#popUpModal .modal-body");
    
    if (status === "success") {
        spanElement.style.color = "yellowgreen";
        modalBody.innerHTML = `<h4 style="color: yellowgreen;">${message } <i style="color: yellowgreen;" class="fa-solid fa-check"></i> </h4>`;
    } else if (status === "error") {
        spanElement.style.color = "#ff4533";
        modalBody.innerHTML = `<h4 style="color:#ff4533 ;">${message }<i style="color:#ff4533;" class="fa-solid fa-circle-xmark"></i></h4>`;
    }
    $('#popUpModal').modal('show');
    setTimeout(() => {
        $('#popUpModal').modal('hide');
    }, 1500);
}

    </script>
</body>
</html>